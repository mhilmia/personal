---
title: "Open Project"
author: "Muhammad Hilmi Aiman (15422140)"
date: "2025-07-29"
output: 
  html_document: 
    toc: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Analyzing Patterns of Mobility in Provinces of the Netherlands through Mobility Index, Cross-Tabulation, and Clustering Approaches

## R Packages

Ada beberapa R packages yang harus dilakukan `library()`. Apabila belum dimiliki, install melalui Console.

```{r}
library(dplyr)
library(tidyr)
library(mice)
library(readr)
library(ggplot2)
library(janitor)
```

## Data

Data yang digunakan bersumber dari CBS Open data StatLine. Berikut merupakan penjelasan data yang dipakai.

| This table contains information regarding the mobility of the residents of the Netherlands aged 6 or older in private households, so excluding residents of institutions and homes. The table contains per person per day /year an overview of the average number of trips, the average distance travelled and the average time travelled. These are regular trips on Dutch territory, including domestic holiday mobility. The distance travelled is based on stage information. Excluded in this table is mobility based on series of calls trips. The mobility behaviour is broken down by modes of travel, purposes of travel, population and region characteristics. The data used are retrieved from The Dutch National travel survey named Onderweg in Nederland (ODiN).

Data yang digunakan merupakan rata-rata per orang per hari dengan populasi orang berusia 12 tahun ke atas.

```{r}
#Membaca data
data_raw <- read_csv2("Data.csv") %>%
  mutate(motives = recode(TravelMotives, #Mengubah motives dari kode menjadi kata
                          "T001080" = "All",
                          "2030170" = "Work",
                          "2030190" = "Services/care",
                          "2030200" = "Shopping",
                          "2030210" = "Attending education",
                          "2030220" = "Visits",
                          "2030230" = "Leisure, sports",
                          "2030240" = "Touring/walking",
                          "2030250" = "Other",
                          "2820740" = "Business trips"
                          ),
         modes = recode(TravelModes, #Mengubah moda dari kode menjadi kata
                        "T001093" = "All",
                        "A048583" = "Car (driver)",
                        "A048584" = "Car (passenger)",
                        "A018981" = "Train",
                        "A018982" = "Bus/tram/metro",
                        "A018984" = "Bike",
                        "A018985" = "Walking",
                        "A018986" = "Other"
                        ),
         provinces = recode(RegionCharacteristics, #Mengubah provinsi dari kode menjadi kata
                            "PV20" = "Groningen",
                            "PV21" = "Fryslân",
                            "PV22" = "Drenthe",
                            "PV23" = "Overijssel",
                            "PV24" = "Flevoland",
                            "PV25" = "Gelderland",
                            "PV26" = "Utrecht",
                            "PV27" = "Noord-Holland",
                            "PV28" = "Zuid-Holland",
                            "PV29" = "Zeeland",
                            "PV30" = "Noord-Brabant",
                            "PV31" = "Limburg"
                            ),
         year = recode(Periods, #Mengubah tahun dari kode menjadi kata
                        "2018JJ00" = 2018,
                        "2019JJ00" = 2019,
                        "2020JJ00" = 2020,
                        "2021JJ00" = 2021,
                        "2022JJ00" = 2022,
                        "2023JJ00" = 2023
                        )
         ) %>%
  rename( #Mengubah nama kolom menjadi trips, distance, dan duration masing-masing
    trips = Trips_1,
    distance = DistanceTravelled_2,
    duration = TimeTravelled_3
    ) %>%
  mutate(across(c(trips, distance, duration), ~na_if(., "."))) %>% #Mengubah data yang "." menjadi NA
  mutate(across(c(trips, distance, duration), as.numeric)) #Mengubah kolom menjadi tipe numerik

#Menentukan data yang berisikan trips, distance, duration, motives, modes, provinces, dan year dari data_raw
data <- data_raw[, c("trips", "distance", "duration","motives","modes","provinces","year")]
data
```

### Missing Data

Karena dalam data berisi beberapa nilai yang NA atau missing data, missing data diatasi dengan imputasi pendekatan mice. Pendekatan mice digunakan karena mampu melakukan imputasi multivariat yang lebih canggih dan realistis dibanding metode sederhana seperti imputasi mean/median, tetapi memakan komputasi yang lebih berat.

```{r}
#Mengubah kolom motives, modes, provinces, dan year menjadi tipe data faktor (kategorikal) karena mice perlu mengetahui kolom yang berupa numerik dan kategorikal
data <- data %>%
  mutate(across(c(motives, modes, provinces, year), as.factor))

#m = 5, melakukan imputasi sebanyak 5 kali; method = "pmm", menggunakan metode yang sering dipakai untuk imputasi; seed = 1542214, menentukan seed agar hasilnya bisa direproduksi
imputed <- mice(data, m = 5, method = 'pmm', seed = 15422140)

#Mengambil salah satu dari hasil imputasi yang sudah dibuat, yaitu hasil ke-1 dari 5 data imputasi yang dihasilkan
data_imputed <- complete(imputed, 1)
data_imputed
```

### Normalizing Data

Nilai-nilai dalam dataset memiliki range yang bervariasi. Sebelum bisa dilakukan analisis, persebaran nilai-nilai tersebut harus disamakan.

```{r}
#Membuat dataset yang terdiri dari trips, distance, dan duration
numerical_data <- data_imputed %>%
  select(trips, distance, duration)

#Menormalisasi data dalam kolom trips, distance, dan duration
numerical_data_normalized <- as.data.frame(scale(numerical_data))
numerical_data_normalized
```

## Mobility Index

PCA digunakan untuk membuat mobility index karena bisa menggabungkan beberapa variabel mobilitas (trips, distance, duration) menjadi satu nilai utama (index mobilisasi) tanpa kehilangan informasi penting. Index mobilisasi menunjukkan pola mobilisasi dari suatu kategori (provinsi, motives, moda).

```{r}
pca_result <- prcomp(numerical_data_normalized, center = TRUE, scale. = TRUE)

#Menampilkan loadings dari setiap variabel terhadap principal components
pca_result$rotation
```

Hasil dari PC1 dimasukkan ke dataset.

```{r}
pca_scores <- as.data.frame(pca_result$x) #Mengubah hasil dari PCA jadi dataframe

#Menambahkan kolom ke data_imputed bernama mobility_index yang diambil dari PC1
data_pca <- data_imputed %>%
  mutate(mobility_index = -1 * pca_scores$PC1) #-1 supaya nilai lebih intuitif
```

### By Province

Melakukan pengklasifikasian tinggi-sedang-rendah index mobilisasi berdasarkan provinsi.

```{r}
mobility_index_province <- data_pca %>%
  group_by(provinces) %>%
  summarise(mean_index = mean(mobility_index, na.rm = TRUE)) %>% #Mengelompokkan data berdasarkan provinsi, lalu menghitung rata-rata indeks mobilitas di tiap provinsi
  mutate(
    #Menghitung rata-rata dan standar deviasi dari seluruh index mobilisasi sebagai dasar klasifikasi
    mean_val = mean(mean_index),
    sd_val = sd(mean_index),
    #Mengklasifikasikan tingkat mobilitas per provinsi berdasarkan mean_val dan sd_val
    mobility_class = case_when(
      mean_index > mean_val + sd_val ~ "High",
      mean_index < mean_val - sd_val ~ "Low",
      TRUE ~ "Medium"
    )
  ) %>%
  #Menghapus kolom bantu mean_val dan sd_val dari hasil akhir, lalu mengurutkan provinsi dari index mobilitas tertinggi ke terendah
  select(-mean_val, -sd_val) %>%
  arrange(desc(mean_index))

mobility_index_province
```

**Interpretasi:**

Berdasarkan mobility class, didapatkan bahwa mobilisasi terklasifikasi tinggi di Provinsi Fryslân, Drenthe, dan Flevoland. Kemudian, provinsi dengan mobilisasi sedang di Groningen, Zeeland, Overijssel, Limburg, Utrecht, Gelderland, dan Noord-Brabant. Provinsi dengan mobilisasi rendah berada di Noord-Holland dan Zuid-Holland. Provinsi Noord-Holland dan Zuid-Holland dapat memiliki mobilisasi rendah karena merupakan daerah pusat aktivitas di Belanda dan provinsi di mana Randstad berada. Sedangkan, provinsi lain memiliki tingkat mobilisasi sedang dan rendah karena penduduk provinsi-provinsi tersebut melakukan mobilisasi menuju Noord-Holland dan Zuid-Holland.

### By Motives

Melakukan pengklasifikasian tinggi-sedang-rendah index mobilisasi berdasarkan motives.

```{r}
mobility_index_motives <- data_pca %>%
  group_by(motives) %>%
  summarise(mean_index = mean(mobility_index, na.rm = TRUE)) %>% #Mengelompokkan data berdasarkan motives, lalu menghitung rata-rata indeks mobilitas di tiap motives
  mutate(
    #Menghitung rata-rata dan standar deviasi dari seluruh index mobilisasi sebagai dasar klasifikasi
    mean_val = mean(mean_index),
    sd_val = sd(mean_index),
    #Mengklasifikasikan tingkat mobilitas per motives berdasarkan mean_val dan sd_val
    mobility_class = case_when(
      mean_index > mean_val + sd_val ~ "High",
      mean_index < mean_val - sd_val ~ "Low",
      TRUE ~ "Medium"
    )
  ) %>%
  #Menghapus kolom bantu mean_val dan sd_val dari hasil akhir, lalu mengurutkan motives dari index mobilitas tertinggi ke terendah
  select(-mean_val, -sd_val) %>%
  arrange(desc(mean_index))

mobility_index_motives
```

**Interpretasi:**

Berdasarkan mobility class, didapatkan bahwa mobilisasi terklasifikasi tinggi untuk alasan kerja dan berjalan-jalan. Kemudian, alasan dengan mobilisasi terklasifikasi sedang untuk belanja, hiburan/olahraga, berkunjung, mengikuti edukasi, trip bisnis, dan lainnya. Sedangkan, alasan dengan mobilisasi rendah adalah untuk perawatan/pelayanan.

### By Modes

Melakukan pengklasifikasian tinggi-sedang-rendah index mobilisasi berdasarkan moda.

```{r}
mobility_index_modes <- data_pca %>%
  group_by(modes) %>%
  summarise(mean_index = mean(mobility_index, na.rm = TRUE)) %>% #Mengelompokkan data berdasarkan moda, lalu menghitung rata-rata indeks mobilitas di tiap moda
  mutate(
    #Menghitung rata-rata dan standar deviasi dari seluruh index mobilisasi sebagai dasar klasifikasi
    mean_val = mean(mean_index),
    sd_val = sd(mean_index),
    #Mengklasifikasikan tingkat mobilitas per moda berdasarkan mean_val dan sd_val
    mobility_class = case_when(
      mean_index > mean_val + sd_val ~ "High",
      mean_index < mean_val - sd_val ~ "Low",
      TRUE ~ "Medium"
    )
  ) %>%
  #Menghapus kolom bantu mean_val dan sd_val dari hasil akhir, lalu mengurutkan moda dari index mobilitas tertinggi ke terendah
  select(-mean_val, -sd_val) %>%
  arrange(desc(mean_index))

mobility_index_modes
```

**Interpretasi:**

Berdasarkan mobility class, didapatkan bahwa mobilisasi terklasifikasi tinggi untuk moda mobil sebagai pengemudi. Kemudian, moda yang mobilisasi terklasifikasi sedang adalah dengan berjalan kaki, bersepeda, mobil sebagai penumpang, kereta, bus/tram/metro, dan lainnya. Tidak ada moda dengan klasifikasi mobilisasi rendah.

## Cross-Tabulation

Cross-tabulation akan membandingkan setiap kategori dengan kategori lainnya, seperti bagaimana perbandingan pola moda yang digunakan dari suatu provinsi dengan provinsi lainnya.

```{r}
#Mengelompokkan data berdasarkan provinsi dan menghitung rata-rata, standar deviasi, dan jumlah observasi dari setiap provinsi
data_pca %>%
  group_by(provinces) %>%
  summarise(
    mean_index = mean(mobility_index, na.rm = TRUE),
    sd_index = sd(mobility_index, na.rm = TRUE),
    n = n()
  )
```

Dilakukan klasifikasi per kategori sebelum lanjut cross-tabulation.

```{r}
#Membuat fungsi untuk pengklasifikasian berdasarkan rata-rata dan standar deviasi
classify_index <- function(x) {
  m <- mean(x, na.rm = TRUE)
  s <- sd(x, na.rm = TRUE)
  #Membagi rentang data menjadi 3 kategori sesuai batas
  cut(x,
      breaks = quantile(x, probs = c(0, 0.33, 0.67, 1), na.rm = TRUE),
      labels = c("Low", "Medium", "High"),
      include.lowest = TRUE)
}

#Data dikelompokkan per provinsi dan mobilitas diklasifikasikan menurut fungsi dengan nilai mobility index dalam masing-masing provinsi
classified_province <- data_pca %>%
  group_by(provinces) %>%
  mutate(class_province = classify_index(mobility_index)) %>%
  ungroup()

#Dari data sebelumnya, dikelompokkan lagi berdasarkan modes dan diklasifikasikan untuk tingkat mobilitas per moda
classified_mode <- classified_province %>%
  group_by(modes) %>%
  mutate(class_mode = classify_index(mobility_index)) %>%
  ungroup()

#Dari data sebelumnya, dikelompokkan lagi berdasarkan motives dan diklasifikasikan untuk tingkat mobilitas per motives
classified_motive <- classified_mode %>%
  group_by(motives) %>%
  mutate(class_motive = classify_index(mobility_index)) %>%
  ungroup()

#Menyimpan hasil akhir ke dalam classified_data
classified_data <- classified_motive
classified_data
```

### Province with Mode

Cross-tabulation dilakukan untuk melihat perbandingan provinsi dengan penggunaan moda

```{r}
#Mmbuat tabel frekuensi dua arah, dari class_province dan modes
tab_prov_mode <- classified_data %>%
  tabyl(class_province, modes)

#Menghitung persentase moda dalam setiap baris, yaitu proporsi moda per kelas mobilitas provinsi
tab_prov_mode_percent <- tab_prov_mode %>%
  adorn_percentages("row") %>%
  adorn_pct_formatting(digits = 1)

tab_prov_mode_percent
```

Dapat dilihat proporsi moda yang digunakan untuk setiap klasifikasi mobilisasi menurut provinsi. Namun, output ini dapat divisualisasikan dengan stacked barplot.

```{r}
#Membuat data proporsi masing-masing moda dalam kelompok mobilitas provinsi untuk visualisasi
viz_data_mode <- classified_data %>%
  group_by(class_province, modes) %>%
  summarise(count = n(), .groups = "drop") %>%
  group_by(class_province) %>%
  mutate(prop = count / sum(count))

#Membuat visualisasi stacked barplot
ggplot(viz_data_mode, aes(x = class_province, y = prop, fill = modes)) + 
  geom_bar(stat = "identity", position = "fill") + 
  scale_y_continuous(labels = scales::percent) +
  labs(
    title = "Distribusi Moda Perjalanan Berdasarkan Klasifikasi Mobilitas Provinsi",
    x = "Klasifikasi Mobilitas Provinsi",
    y = "Proporsi (%)",
    fill = "Moda"
  ) +
  theme_minimal()
```

**Interpretasi:**

Berdasarkan stacked barplot, dilihat bahwa moda yang paling banyak digunakan untuk provinsi dengan mobilisasi tinggi adalah mobil sebagai pengemudi dan sepeda. Sedangkan, mobilisasi yang paling sedikit digunakan adalah bus/tram/metro dan lainnya. Moda yang digunakan untuk provinsi dengan mobilisasi sedang cenderung tersebar untuk setiap moda, dengan moda yang paling banyak digunakan adalah kereta. Sedangkan moda yang paling banyak digunakan untuk provinsi dengan mobilisasi rendah adalah bus/tram/metro dan lainnya.

Uji chi-square dapat dilakukan untuk mengetahui apakah ada hubungan yang signifikan antara provinsi dengan moda.

```{r}
#Membuat tabel silang yang menunjukkan jumlah observasi untuk setiap kombinasi
mode_table <- table(classified_data$class_province, classified_data$modes)

#Melakukan uji chi-square
chisq_test_mode_result <- chisq.test(mode_table)

#Melihat hasilnya
chisq_test_mode_result
```

**Interpretasi:**

Berdasarkan uji chi-square, ditentukan bahwa terdapat hubungan antara provinsi dengan moda. Hal ini berarti terdapat perbedaan pola penggunaan moda yang signifikan antara provinsi dengan mobilitas rendah, sedang, dan tinggi.

Setelah itu, heatmap residual dilakukan untuk sebagai tindak lanjut dari hasil uji chi-square.

```{r}
#Menghasilkan residual standar dari tabel silang
std_residuals_mode <- chisq_test_mode_result$stdres

#Mengubah residual mejadi dataframe
res_df_mode <- as.data.frame(as.table(std_residuals_mode))
colnames(res_df_mode) <- c("Mobility_Class", "Mode", "Std_Residual")

#Membuat heatmap residual
#Biru = residual negatif (kurang dari ekspektasi); Putih = mendekati ekspektasi; Merah = residual positif (lebih dari ekspektasi)
ggplot(res_df_mode, aes(x = Mode, y = Mobility_Class, fill = Std_Residual)) +
  geom_tile(color = "white") +
  scale_fill_gradient2(low = "blue", mid = "white", high = "red", midpoint = 0) +
  labs(title = "Standardized Residuals (Moda x Kelas Provinsi)",
       x = "Jenis Moda", y = "Kelas Provinsi") +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis text
  )
```

**Interpretasi:**

Berdasarkan heatmap residual, ditentukan bahwa di provinsi dengan mobilisasi tinggi, moda mobil sebagai pengemudi dipakai lebih banyak daripada ekspektasi serta moda bus/tram/metro dan lainnya dipakai kurang daripada ekspektasi. Di provinsi dengan mobilisasi rendah, moda bus/tram/metro dan lainnya dipakai lebih dari ekspektasi serta mobil sebagai pengemudi dipakai kurang dari ekspektasi.

### Province with Motive

Cross-tabulation dilakukan untuk melihat perbandingan provinsi dengan penggunaan moda

```{r}
##Mmbuat tabel frekuensi dua arah, dari class_province dan motives
tab_prov_motives <- classified_data %>%
  tabyl(class_province, motives)

#Menghitung persentase moda dalam setiap baris, yaitu proporsi motives per kelas mobilitas provinsi
tab_prov_motives_percent <- tab_prov_motives %>%
  adorn_percentages("row") %>%
  adorn_pct_formatting(digits = 1)

tab_prov_motives_percent
```

Dapat dilihat proporsi alasan mobilisasi untuk setiap klasifikasi mobilisasi menurut provinsi. Namun, output ini dapat divisualisasikan dengan stacked barplot.

```{r}
#Membuat data proporsi masing-masing moda dalam kelompok mobilitas provinsi untuk visualisasi
viz_data_motives <- classified_data %>%
  group_by(class_province, motives) %>%
  summarise(count = n(), .groups = "drop") %>%
  group_by(class_province) %>%
  mutate(prop = count / sum(count))

#Membuat visualisasi stacked barplot
ggplot(viz_data_motives, aes(x = class_province, y = prop, fill = motives)) +
  geom_bar(stat = "identity", position = "fill") +
  scale_y_continuous(labels = scales::percent) +
  labs(
    title = "Distribusi Alasan Perjalanan Berdasarkan Klasifikasi Mobilitas Provinsi",
    x = "Klasifikasi Mobilitas Provinsi",
    y = "Proporsi (%)",
    fill = "Alasan"
  ) +
  theme_minimal()
```

**Interpretasi:**

Berdasarkan stacked barplot, dilihat bahwa alasan mobilisasi yang paling banyak di provinsi dengan mobilisasi tinggi adalah untuk berjalan-jalan, hiburan, dan olahraga. Sedangkan, alasan mobilisasi yang paling sedikit adalah untuk perawatan/pelayanan. Alasan mobilisasi untuk provinsi dengan mobilisasi sedang cenderung tersebar, dengan alasan yang paling banyak adalah trip bisnis. Di provinsi dengan mobilisasi rendah, alasan mobilisasi yang paling banyak adalah untuk pelayanan/perawatan serta yang paling rendah adalah untuk berjalan-jalan.

Uji chi-square dapat dilakukan untuk mengetahui apakah ada hubungan yang signifikan antara provinsi dengan alasan mobilisasi.

```{r}
#Membuat tabel silang yang menunjukkan jumlah observasi untuk setiap kombinasi
motives_table <- table(classified_data$class_province, classified_data$motives)

#Melakukan uji chi-square
chisq_test_motives_result <- chisq.test(motives_table)

#Melihat hasilnya
chisq_test_motives_result
```

**Interpretasi:**

Berdasarkan uji chi-square, ditentukan bahwa terdapat hubungan antara provinsi dengan alasan mobilisasi. Hal ini berarti terdapat perbedaan pola alasan mobilisasi yang signifikan antara provinsi dengan mobilitas rendah, sedang, dan tinggi.

```{r}
#Menghasilkan residual standar dari tabel silang
std_residuals_motives <- chisq_test_motives_result$stdres

#Mengubah residual mejadi dataframe
res_df_motives <- as.data.frame(as.table(std_residuals_motives))
colnames(res_df_motives) <- c("Mobility_Class", "Motives", "Std_Residual")

#Membuat heatmap residual
#Biru = residual negatif (kurang dari ekspektasi); Putih = mendekati ekspektasi; Merah = residual positif (lebih dari ekspektasi)
ggplot(res_df_motives, aes(x = Motives, y = Mobility_Class, fill = Std_Residual)) +
  geom_tile(color = "white") +
  scale_fill_gradient2(low = "blue", mid = "white", high = "red", midpoint = 0) +
  labs(title = "Standardized Residuals (Alasan x Kelas Provinsi)",
       x = "Alasan", y = "Kelas Provinsi") +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis text
  )
```

**Interpretasi:**

Berdasarkan heatmap residual, ditentukan bahwa di provinsi dengan mobilisasi tinggi, berjalan-jalan dan hiburan adalah alasan mobilisasi yang lebih banyak daripada ekspektasi serta pelayanan/perawatan, trip bisnis, dan mengikuti edukasi adalah alasan mobilisasi yang kurang daripada ekspektasi. Di provinsi dengan mobilisasi rendah, pelayanan/perawatan adalah alasan mobilisasi yang lebih dari ekspektasi serta berjalan-jalan adalah alasan mobilisasi yang kurang dari ekspektasi.

## Clustering

Clustering dilakukan berdasarkan provinsi, sehingga akan mendapatkan pengelompokkan provinsi berdasarkan komponen mobilisasi.

**Data**

```{r}
#Menghitung rata-rata untuk trips, distance, dan duration per provinsi
data_province <- data_imputed %>%
  group_by(provinces) %>%
  summarise(
    avg_trips_per_prov = mean(trips, na.rm = TRUE),
    avg_distance_per_prov = mean(distance, na.rm = TRUE),
    avg_duration_per_prov = mean(duration, na.rm = TRUE)
  ) %>%
  ungroup()
data_province
```

```{r}
#Menormalisasikan ketiga variabel mobilisasi dari setiap provinsi
data_province_norm <- data_province %>%
  mutate(across(
    c(avg_trips_per_prov, avg_distance_per_prov, avg_duration_per_prov),
    ~ as.numeric(scale(.))
  ))
data_province_norm
```

### Distance Matrix

Sebelum melakukan clustering, distance matrix dihitung untuk mengetahui jarak (euclidean distance), sehingga dapat ditentukan seberapa mirip atau seberapa berbeda antar provinsi berdasarkan trips, distance, dan duration. Semakin kecil distance matrix, maka semakin mirip provinsi berdasarkan trips, distance, dan duration, dan sebaliknya.

```{r}
data_dist_mat <- as.data.frame(data_province_norm) #Mengubah ke bentuk dataframe agar lebih mudah dimodifikasi
rownames(data_dist_mat) <- data_dist_mat$provinces #Menjadikan nama provinsi sebagai nama baris
data_dist_mat <- data_dist_mat %>% select(-provinces) #Menghapus kolom provinces dari isi data

#Menghitung jarak matrix antar provinsi dengan metode Euclidean
distance_matrix <- dist(data_dist_mat, method = "euclidean")

#Melihat hasilnya
distance_matrix
```

**Interpretasi:**

Berdasarkan distance matrix, ditentukan bahwa provinsi yang paling saling mirip adalah Gelderland dengan Noord-Brabant dan Drenthe dengan Fryslân. Sedangkan provinsi yang paling saling berbeda adalah Fryslân dengan Zuid-Holland dan Drenthe dengan Zuid-Holland.

### Optimal Clusters

Penentuan jumlah cluster digunakan metode WCSS karena cocok digunakan dengan K-mean serta dapat dilihat titik “tekukan” dalam grafik yang menunjukkan jumlah klaster optimal.

```{r}
#Melakukan inisialisasi dan perulangan K-Means
n_clusters <- 10 #Menguji klaster sebanyak 10 agar efisien
wss <- numeric(n_clusters)
set.seed(15422140) #Menentukan seed agar hasil konsisten
for (i in 1:n_clusters) {
  km.out <- kmeans(data_dist_mat, centers = i, nstart = 20)
  wss[i] <- km.out$tot.withinss
}
#Membuat tabel dan scree plot
wss_df <- tibble(clusters = 1:n_clusters, wss = wss)
scree_plot <- ggplot(wss_df, aes(x = clusters, y = wss, group = 1)) +
    geom_point(size = 4)+
    geom_line() +
    scale_x_continuous(breaks = c(2, 4, 6, 8, 10)) +
    xlab('Number of clusters')
#Menambahkan garis horizontal di setiap nilai WSS
scree_plot +
    geom_hline(
        yintercept = wss, 
        linetype = 'dashed', 
        col = c(rep('#000000',2),'#FF0000', rep('#000000', 7)) #Warna merah menandai "tekukan" atau jumlah klaster optimal
    )
```

Berdasarkan screeplot, melihat dari titik “tekukan” di mana penurunan WSS mulai melambat, jumlah klaster optimal sebanyak 3.

### K-Means

Metode ini menentukan pusat dari klaster, sehingga jarak antar klasternya minimal dan data setiap titik dalam setiap klaster sama dengan karakteristiknya.

```{r}
#Menjalankan clustering K-Means untuk membentuk 3 klaster
set.seed(15422140) #Menentukan seed agar hasil konsisten
km.out <- kmeans(data_dist_mat, centers = 3, nstart = 20)
km.out
```

Berdasarkan output di atas, terlihat bahwa klaster terdiri dari 7, 3, dan 2 anggota. Kemudian, hasil klaster akan ditambahkan ke dataframe.

```{r}
#Menambahkan hasil klaster ke data provinsi yang sudah dinormalisasi
data_clusters_kmeans <- data_dist_mat
data_clusters_kmeans$Cluster <- km.out$cluster
data_clusters_kmeans
```

Anggota provinsi dapat dilihat dari setiap klaster sebagai berikut.

```{r}
#Menampilkan provinsi-provinsi yang termasuk ke dalam masing-masing klaster
cluster_provinces <- rownames(data_clusters_kmeans)
for(k in unique(data_clusters_kmeans$Cluster)) {
  cat(paste("Klaster", k, ": \n"))
  cat(paste(cluster_provinces[data_clusters_kmeans$Cluster == k], collapse = ", "), "\n\n")
}
```

**Interpretasi:**

Berdasarkan output di atas, terlihat:

-   Klaster 1: Gelderland, Groningen, Limburg, Noord-Brabant, Overijssel, Utrecht, Zeeland

-   Klaster 2: Drenthe, Flevoland, Fryslân

-   Klaster 3: Noord-Holland, Zuid-Holland

Pembagian klaster ini dapat dijelaskan dari karakteristik setiap klaster sebagai berikut.

```{r}
#Memperlihatkan karakteristik rata-rata, standar deviasi, dan median data normal dari setiap klaster
cluster_summary_kmeans <- data_clusters_kmeans %>%
  group_by(Cluster) %>%
  summarize_all(list(mean = mean, sd = sd, median = median))
cluster_summary_kmeans
```

**Interpretasi:**

Berdasarkan output di atas, bahwa klaster 2 memiliki tingkat mobilisasi yang tinggi daripada klaster lain, diikuti dengan klaster 1 dan 3. Klaster 1 dan 2 memiliki tingkat mobilisasi yang lebih tinggi daripada klaster 3 karena penduduk dari provinsi di klaster 1 dan 2 melakukan perjalanan ke provinsi di klaster 3.
